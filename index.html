<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>Carraro OS - VRML Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body { 
            margin: 0; overflow: hidden; background-color: #000; 
            font-family: 'Press Start 2P', cursive; 
            touch-action: none; -webkit-tap-highlight-color: transparent;
            user-select: none; 
        }
        .scanlines {
            position: fixed; left: 0; top: 0; width: 100vw; height: 100vh;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.05) 50%, rgba(0,0,0,0.05));
            background-size: 100% 4px; pointer-events: none; z-index: 50;
        }
        #boot-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #000; z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        #boot-log { 
            font-family: 'Press Start 2P', cursive; color: #44ff44; font-size: 12px;
            text-align: left; width: 680px; max-width: 90%; height: 400px; overflow: hidden; line-height: 2.0;
            margin-top: 20px;
        }
        .log-line { margin-bottom: 5px; opacity: 0; animation: fadeIn 0.1s forwards; }
        @keyframes fadeIn { to { opacity: 1; } }
        
        #start-btn {
            margin-top: 20px; display: none;
            background: transparent; border: 2px solid #44ff44; color: #44ff44;
            padding: 15px 30px; font-family: 'Press Start 2P'; font-size: 14px; cursor: pointer;
            text-transform: uppercase; box-shadow: 0 0 10px #44ff44; pointer-events: auto;
        }
        #start-btn:hover { background: #44ff44; color: #000; }

        #header {
            position: absolute; top: 20px; left: 20px; color: #44ff44; font-size: 10px; z-index: 10;
            pointer-events: none; text-shadow: 0 0 5px #44ff44; display: none;
        }
        #product-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.92); z-index: 2000; align-items: center; justify-content: center;
        }
        .modal-content {
            background: #000; border: 2px solid #44ff44; box-shadow: 0 0 50px rgba(68, 255, 68, 0.4);
            padding: 30px; width: 85%; max-width: 750px; color: #44ff44; position: relative;
            display: flex; flex-direction: column; z-index: 2001; 
        }
        .modal-image-container { text-align: center; margin-bottom: 25px; border-bottom: 2px dashed #44ff44; padding-bottom: 25px; background: #051505;}
        .modal-image { width: 96px; height: 96px; image-rendering: pixelated; border: 2px solid #228822; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        #m-title { font-size: 16px; color: #fff; text-shadow: 2px 2px 0 #005500; line-height: 1.5; }
        #m-year { font-size: 10px; background: #004400; padding: 6px 10px; color: #fff; }
        .modal-body { font-size: 11px; line-height: 1.8; color: #ccffcc; font-family: 'Press Start 2P'; text-align: justify; }
        .close-btn {
            margin-top: 25px; width: 100%; padding: 15px; background: #003300; border: 1px solid #44ff44; 
            color: #44ff44; font-family: 'Press Start 2P'; cursor: pointer; text-transform: uppercase; font-size: 12px;
        }
        canvas { display: block; position: absolute; top:0; left:0; z-index: 1; }
        
        #version-tag {
            position: fixed; bottom: 10px; right: 10px; background-color: #aa0000; color: #fff; padding: 5px;
            font-size: 10px; border: 1px solid #fff; z-index: 10000; pointer-events: none; 
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>
</head>
<body>

    <div id="boot-screen">
        <img src="twins.png" style="width: 280px; margin-bottom: 30px; image-rendering: pixelated;" alt="Twins">
        <div id="boot-log"></div>
        <button id="start-btn" onclick="startSystem()">[ ACCEDI ALL'ARCHIVIO ]</button>
    </div>
    
    <audio id="bg-music" loop><source src="music.mp3" type="audio/mpeg"></audio>
    <div class="scanlines"></div>
    <div id="header">DESKTOP: CLICK TO SELECT <br> MOBILE: DRAG TO MOVE</div>
    <div id="version-tag">VRML UPDATE</div>

    <div id="product-modal">
        <div class="modal-content">
            <div class="modal-image-container"><img id="m-image" class="modal-image" src="" alt="Icon"></div>
            <div class="modal-header"><span id="m-title">TITLE</span><span id="m-year">2000</span></div>
            <div id="m-desc" class="modal-body">Description...</div>
            <button class="close-btn" onclick="closeModal()">[ CHIUDI SCHEDA ]</button>
        </div>
    </div>

    <script>
        (function updateTimestamp() {
            const now = new Date();
            const timeString = now.getHours().toString().padStart(2,'0') + ":" + now.getMinutes().toString().padStart(2,'0') + ":" + now.getSeconds().toString().padStart(2,'0');
            const tag = document.getElementById('version-tag');
            if(tag) tag.innerText = "VRML: " + timeString;
        })();

        // --- ASSETS ---
        function generateRetroImage(type) {
            const c = document.createElement('canvas'); c.width = 64; c.height = 64; const ctx = c.getContext('2d');
            ctx.fillStyle = "#051105"; ctx.fillRect(0,0,64,64); ctx.fillStyle = "#44ff44"; 
            if(type==='cd'){ ctx.beginPath(); ctx.arc(32,32,25,0,6.28); ctx.fill(); ctx.fillStyle="#000"; ctx.beginPath(); ctx.arc(32,32,8,0,6.28); ctx.fill(); }
            else if(type==='vr'){ ctx.fillRect(10,20,44,24); ctx.fillStyle="#000"; ctx.fillRect(15,25,14,14); ctx.fillRect(35,25,14,14); }
            else if(type==='tab'){ ctx.fillRect(12,10,40,44); ctx.fillStyle="#000"; ctx.fillRect(16,14,32,36); }
            else if(type==='logo'){ ctx.font="40px monospace"; ctx.fillText("C",20,45); ctx.strokeRect(5,5,54,54); }
            else { ctx.fillRect(20,10,24,44); ctx.fillStyle="#000"; ctx.fillRect(24,15,16,5); ctx.fillRect(24,25,16,5); }
            return c.toDataURL();
        }
        const assets = { cd: generateRetroImage('cd'), vr: generateRetroImage('vr'), tab: generateRetroImage('tablet'), logo: generateRetroImage('logo'), file: generateRetroImage('file') };
        const archiveWords = ["M9 Museum", "Brixia Time Machine", "Cenacolo Vinciano", "Tharros", "Bibleworld", "Museo Egizio", "Valle dei Templi", "Arena Verona", "Matera Sassi", "Teatro La Fenice", "Duomo Milano", "Parco Leonardo", "Immersive Academia", "Palazzo Reale", "Street View 2006", "Leonardo", "Dante", "Giotto", "Pompei", "Venezia", "Milano"];

        // --- SCENE CONFIG ---
        // BOTTONI AVVICINATI (x: 18 invece di 40)
        const SCENES = {
            "HOME": [
                { text: "CHI SIAMO", target: "CHI_SIAMO", x: 0, y: 15, z: 0, color: "#44ff44", scale: 2.5 }, 
                { text: "COSA FACCIAMO", target: "COSA_FACCIAMO", x: -18, y: 0, z: 0, color: "#44ff44", scale: 2.5 },
                { text: "PRODOTTI", target: "PRODOTTI", x: 0, y: -15, z: 0, color: "#44ff44", scale: 2.5 },
                { text: "VISION", target: "VISION", x: 18, y: 0, z: 0, color: "#44ff44", scale: 2.5 }
            ],
            "CHI_SIAMO": [
                { text: "< HOME", target: "HOME", x: 0, y: 35, z: 0, color: "#ff4444", scale: 2.5 },
                { text: "GUALTIERO", x: -18, y: 0, z: 0, color: "#00ffff", scale: 2.5, details: {year:"FOUNDER", image:assets.logo, tech:"STRATEGY", desc:"Gualtiero Carraro."} },
                { text: "ROBERTO", x: 18, y: 0, z: 0, color: "#00ffff", scale: 2.5, details: {year:"FOUNDER", image:assets.logo, tech:"DEV", desc:"Roberto Carraro."} }
            ],
            "COSA_FACCIAMO": [
                { text: "< HOME", target: "HOME", x: 0, y: 35, z: 0, color: "#ff4444", scale: 2.5 },
                { text: "VR / AR", x: -18, y: 0, z: 0, color: "#ff00ff", scale: 2.5, details: {year:"XR", image:assets.vr, tech:"VR", desc:"Ambienti immersivi."} },
                { text: "AI GEN", x: 18, y: 0, z: 0, color: "#ff00ff", scale: 2.5, details: {year:"AI", image:assets.logo, tech:"GPT", desc:"Intelligenza Artificiale."} }
            ],
            "VISION": [
                { text: "< HOME", target: "HOME", x: 0, y: 40, z: 0, color: "#ff4444", scale: 2.5 },
                { text: "NEURAL UI", x: 0, y: 5, z: 0, color: "#ffffff", scale: 2.5, details: {year:"R&D", image:assets.vr, tech:"BCI", desc:"Interfacce Neurali."} },
                { text: "AI ETHICS", x: -20, y: -10, z: 0, color: "#ffffff", scale: 2.5, details: {year:"ETHICS", image:assets.logo, tech:"HUMANISM", desc:"Umanesimo Digitale."} },
                { text: "SPATIAL WEB", x: 20, y: -10, z: 0, color: "#ffffff", scale: 2.5, details: {year:"WEB3", image:assets.tab, tech:"XR", desc:"Spatial Computing."} }
            ],
            "PRODOTTI": [] 
        };

        function generateProductSphere() {
            const items = [];
            items.push({ text: "< HOME", target: "HOME", x: 0, y: 40, z: -10, color: "#ff4444", scale: 2.5 });
            const heroes = [
                { t:"OMNIA", y:"1996-2005", i:assets.cd, tech:"HERO", d:"OMNIA - ENCICLOPEDIA MULTIMEDIALE" },
                { t:"ROMA 3D", y:"2011", i:assets.tab, tech:"HERO", d:"VIRTUAL HISTORY ROMA" },
                { t:"EXPO 2015", y:"2015", i:assets.vr,
